import { KonvaEventObject } from 'konva/lib/Node'
import { AnnotationType, IAnnotationStore, IAnnotationStyle } from '../../const/definitions'
import { Editor, IEditorOptions } from './editor'
import { createSvgIcon } from '../../utils/documentIcon'

const markerSvg = `
<svg width="128" height="116" viewBox="0 0 128 116" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M98.7446 22.6649C101.551 22.6649 103.827 24.9403 103.828 27.7469C103.828 30.5538 101.551 32.83 98.7446 32.83C95.938 32.8297 93.6626 30.5537 93.6626 27.7469C93.6628 24.9404 95.9381 22.6652 98.7446 22.6649Z" fill="#174377" stroke="black" stroke-width="3"/>
<path d="M98.7456 5.84302C110.315 5.84319 118.253 12.7465 123.083 19.0208C124.353 20.6712 125.161 21.7355 125.696 22.9456C126.208 24.1056 126.5 25.4865 126.5 27.7473C126.5 30.0081 126.208 31.389 125.696 32.5491C125.161 33.7592 124.353 34.8235 123.083 36.4739C118.253 42.748 110.315 49.6514 98.7456 49.6516C87.1758 49.6516 79.2373 42.7481 74.4077 36.4739C73.1374 34.8235 72.329 33.7591 71.7944 32.5491C71.2819 31.389 70.9897 30.0081 70.9897 27.7473C70.9897 25.4865 71.2819 24.1056 71.7944 22.9456C72.329 21.7355 73.1374 20.6712 74.4077 19.0208C79.2373 12.7464 87.1758 5.84302 98.7456 5.84302ZM98.7456 15.2766C91.8582 15.2766 86.2739 20.8599 86.2739 27.7473C86.2739 34.6348 91.8582 40.218 98.7456 40.218C105.633 40.2178 111.216 34.6347 111.216 27.7473C111.216 20.8601 105.633 15.2768 98.7456 15.2766Z" fill="#174377" stroke="black" stroke-width="3"/>
<mask id="path-3-inside-1_885_470" fill="white">
<path d="M57.9072 0C66.0423 0 73.7859 1.46908 80.8105 4.11914C76.0379 7.0139 72.3172 10.7559 69.5791 14.1904L69.0586 14.8545C67.908 16.3484 66.5581 18.0568 65.6426 20.1279C64.6524 22.3681 64.2774 24.7189 64.2773 27.5781C64.2773 30.4376 64.6523 32.789 65.6426 35.0293C66.5581 37.1003 67.908 38.8079 69.0586 40.3018C74.479 47.3391 84.1155 56.0253 98.5879 56.0254C105.369 56.0254 111.088 54.118 115.81 51.3672C115.383 79.0293 89.6204 101.338 57.9072 101.338C54.2051 101.338 50.5934 101.002 47.083 100.423L21.7158 115.815V90.1875C8.48754 80.9042 0 66.6623 0 50.6689C0.000148596 22.6889 25.928 0.000195993 57.9072 0ZM97.4531 50.9375C97.8276 50.9515 98.2058 50.959 98.5879 50.959L98.0176 50.9541C97.8285 50.9506 97.6403 50.9445 97.4531 50.9375ZM91.6152 50.123L92.1172 50.2422C91.7802 50.1655 91.4468 50.0838 91.1172 49.9961C91.2822 50.04 91.4483 50.0819 91.6152 50.123Z"/>
</mask>
<path d="M57.9072 0C66.0423 0 73.7859 1.46908 80.8105 4.11914C76.0379 7.0139 72.3172 10.7559 69.5791 14.1904L69.0586 14.8545C67.908 16.3484 66.5581 18.0568 65.6426 20.1279C64.6524 22.3681 64.2774 24.7189 64.2773 27.5781C64.2773 30.4376 64.6523 32.789 65.6426 35.0293C66.5581 37.1003 67.908 38.8079 69.0586 40.3018C74.479 47.3391 84.1155 56.0253 98.5879 56.0254C105.369 56.0254 111.088 54.118 115.81 51.3672C115.383 79.0293 89.6204 101.338 57.9072 101.338C54.2051 101.338 50.5934 101.002 47.083 100.423L21.7158 115.815V90.1875C8.48754 80.9042 0 66.6623 0 50.6689C0.000148596 22.6889 25.928 0.000195993 57.9072 0ZM97.4531 50.9375C97.8276 50.9515 98.2058 50.959 98.5879 50.959L98.0176 50.9541C97.8285 50.9506 97.6403 50.9445 97.4531 50.9375ZM91.6152 50.123L92.1172 50.2422C91.7802 50.1655 91.4468 50.0838 91.1172 49.9961C91.2822 50.04 91.4483 50.0819 91.6152 50.123Z" fill="#174377"/>
<path d="M57.9072 0V-3H57.9072L57.9072 0ZM80.8105 4.11914L82.3663 6.68419L87.6363 3.48777L81.8695 1.31223L80.8105 4.11914ZM69.5791 14.1904L67.2333 12.3203L67.2256 12.33L67.218 12.3397L69.5791 14.1904ZM69.0586 14.8545L66.6975 13.0038L66.6896 13.0138L66.6818 13.0239L69.0586 14.8545ZM65.6426 20.1279L62.8987 18.915L62.8987 18.9151L65.6426 20.1279ZM64.2773 27.5781L61.2773 27.5781V27.5781H64.2773ZM65.6426 35.0293L62.8987 36.2422L62.8987 36.2422L65.6426 35.0293ZM69.0586 40.3018L66.6818 42.1323L66.6819 42.1324L69.0586 40.3018ZM98.5879 56.0254L98.5879 59.0254H98.5879V56.0254ZM115.81 51.3672L118.809 51.4135L118.891 46.0997L114.299 48.7751L115.81 51.3672ZM57.9072 101.338L57.9072 104.338H57.9072V101.338ZM47.083 100.423L47.5712 97.4628L46.4759 97.2822L45.5267 97.8581L47.083 100.423ZM21.7158 115.815H18.7158V121.145L23.2721 118.38L21.7158 115.815ZM21.7158 90.1875H24.7158V88.6278L23.4391 87.7319L21.7158 90.1875ZM0 50.6689L-3 50.6689V50.6689H0ZM98.5879 50.959L98.5879 53.959L98.6136 47.9591L98.5879 50.959ZM98.0176 50.9541L97.9615 53.9536L97.9767 53.9539L97.9919 53.954L98.0176 50.9541ZM91.6152 50.123L90.8968 53.0358L90.9096 53.0389L90.9224 53.042L91.6152 50.123ZM92.1172 50.2422L91.4519 53.1675L92.81 47.3233L92.1172 50.2422ZM91.1172 49.9961L91.8884 47.0969L90.3459 52.8953L91.1172 49.9961ZM57.9072 0V3C65.6806 3 73.0654 4.40368 79.7516 6.92605L80.8105 4.11914L81.8695 1.31223C74.5063 -1.46552 66.404 -3 57.9072 -3V0ZM80.8105 4.11914L79.2547 1.55409C74.1012 4.67993 70.1258 8.69201 67.2333 12.3203L69.5791 14.1904L71.9249 16.0605C74.5085 12.8198 77.9747 9.34788 82.3663 6.68419L80.8105 4.11914ZM69.5791 14.1904L67.218 12.3397L66.6975 13.0038L69.0586 14.8545L71.4197 16.7052L71.9402 16.0411L69.5791 14.1904ZM69.0586 14.8545L66.6818 13.0239C65.5786 14.4563 63.987 16.4532 62.8987 18.915L65.6426 20.1279L68.3864 21.3409C69.1293 19.6605 70.2374 18.2405 71.4353 16.6851L69.0586 14.8545ZM65.6426 20.1279L62.8987 18.9151C61.6902 21.649 61.2774 24.4437 61.2773 27.5781L64.2773 27.5781L67.2773 27.5782C67.2774 24.9942 67.6146 23.0871 68.3865 21.3408L65.6426 20.1279ZM64.2773 27.5781H61.2773C61.2773 30.7126 61.6901 33.5079 62.8987 36.2422L65.6426 35.0293L68.3865 33.8164C67.6145 32.07 67.2773 30.1625 67.2773 27.5781H64.2773ZM65.6426 35.0293L62.8987 36.2422C63.987 38.7042 65.5791 40.7006 66.6818 42.1323L69.0586 40.3018L71.4353 38.4712C70.2369 36.9151 69.1291 35.4965 68.3865 33.8164L65.6426 35.0293ZM69.0586 40.3018L66.6819 42.1324C72.3707 49.5182 82.7846 59.0253 98.5879 59.0254L98.5879 56.0254L98.5879 53.0254C85.4464 53.0253 76.5872 45.16 71.4353 38.4711L69.0586 40.3018ZM98.5879 56.0254V59.0254C105.96 59.0254 112.195 56.9452 117.32 53.9593L115.81 51.3672L114.299 48.7751C109.981 51.2908 104.778 53.0254 98.5879 53.0254V56.0254ZM115.81 51.3672L112.81 51.3209C112.414 76.991 88.3593 98.3379 57.9072 98.3379V101.338V104.338C90.8816 104.338 118.352 81.0676 118.809 51.4135L115.81 51.3672ZM57.9072 101.338L57.9072 98.3379C54.387 98.3379 50.9394 98.0184 47.5712 97.4628L47.083 100.423L46.5948 103.383C50.2473 103.985 54.0231 104.338 57.9072 104.338L57.9072 101.338ZM47.083 100.423L45.5267 97.8581L20.1595 113.251L21.7158 115.815L23.2721 118.38L48.6393 102.988L47.083 100.423ZM21.7158 115.815H24.7158V90.1875H21.7158H18.7158V115.815H21.7158ZM21.7158 90.1875L23.4391 87.7319C10.8878 78.9236 3 65.543 3 50.6689H0H-3C-3 67.7816 6.08734 82.8848 19.9925 92.6431L21.7158 90.1875ZM0 50.6689L3 50.669C3.00014 24.7095 27.1961 3.00019 57.9072 3L57.9072 0L57.9072 -3C24.6599 -2.9998 -2.99984 20.6684 -3 50.6689L0 50.6689ZM97.4531 50.9375L97.3409 53.9354C97.751 53.9507 98.1667 53.959 98.5879 53.959L98.5879 50.959L98.5879 47.959C98.2449 47.959 97.9041 47.9523 97.5653 47.9396L97.4531 50.9375ZM98.5879 50.959L98.6136 47.9591L98.0433 47.9542L98.0176 50.9541L97.9919 53.954L98.5622 53.9589L98.5879 50.959ZM98.0176 50.9541L98.0737 47.9546C97.9106 47.9516 97.7429 47.9462 97.5653 47.9396L97.4531 50.9375L97.3409 53.9354C97.5377 53.9428 97.7464 53.9496 97.9615 53.9536L98.0176 50.9541ZM91.6152 50.123L90.9224 53.042L91.4244 53.1611L92.1172 50.2422L92.81 47.3233L92.3081 47.2041L91.6152 50.123ZM92.1172 50.2422L92.7825 47.3169C92.4781 47.2477 92.1801 47.1745 91.8884 47.0969L91.1172 49.9961L90.3459 52.8953C90.7134 52.993 91.0823 53.0834 91.4519 53.1675L92.1172 50.2422ZM91.1172 49.9961L90.346 52.8953C90.5353 52.9456 90.7207 52.9923 90.8968 53.0358L91.6152 50.123L92.3337 47.2103C92.176 47.1714 92.0291 47.1343 91.8884 47.0969L91.1172 49.9961Z" fill="black" mask="url(#path-3-inside-1_885_470)"/>
</svg>
`

export class EditorNote extends Editor {
    constructor(EditorOptions: IEditorOptions) {
        super({ ...EditorOptions, editorType: AnnotationType.NOTE })
    }

    protected mouseDownHandler() {}
    protected mouseMoveHandler() {}

    protected async mouseUpHandler(e: KonvaEventObject<PointerEvent>) {
        // const color = 'rgb(255, 222, 33)'
        const color = 'rgb(23, 67, 119)'
        const { x, y } = this.konvaStage.getRelativePointerPosition()
        if (e.currentTarget !== this.konvaStage) {
            return
        }
        this.isPainting = true
        this.currentShapeGroup = this.createShapeGroup()
        this.getBgLayer().add(this.currentShapeGroup.konvaGroup)

        // const docIcon = createDocumentIcon({ x, y, fill: color })
        const docIcon = await createSvgIcon({
            x,
            y,
            svg: markerSvg,
            size: 18
        })

        this.currentShapeGroup.konvaGroup.add(...docIcon)
        const id = this.currentShapeGroup.konvaGroup.id()
        this.setShapeGroupDone({
            id,
            contentsObj: {
                text: ''
            },
            color
        })
    }

    protected changeStyle(): void {}
}
